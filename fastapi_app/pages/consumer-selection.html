<!DOCTYPE html>
<html lang="en-us">
  <head>
    {% set title='Consumer Selection' %}
    {% include '_head.html' %}
    {% include '_style_msg_box.html' %}

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw-src.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.0.6/dist/geosearch.css" />
<script src="https://unpkg.com/leaflet-geosearch@3.0.6/dist/geosearch.umd.js"></script>

      <style>
          {% include '_toggle.html' %}
      .leaflet-control-trashbin a {
  font-size: 20px;
  line-height: 20px;
  width: 26px;
  height: 26px;
  display: block;
  text-align: center;
  text-decoration: none;
}
#search-container {
  width: 100%;
}

#search-input {
  width: 100%;
  box-sizing: border-box;
  padding: 5px;}


.list_container {
    display: flex;
    }

.dropdown, .list {
    width: 30%;
    padding: 5px; // Decreased from 10px to 5px
}

.list {
    border: 1px solid black;
    min-height: 100px;
}


    #load_list > div {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .right-align {
        margin-left: auto;
    }
.input-item select, .input-group input, .input-group-text, .btn btn--medium {
    height: 32px; /* Adjust this value to your preference */
}

      </style>
  </head>
  <body onload="redirect_if_cookie_is_missing(true, true);
                db_nodes_to_js({{ project_id }}, true);
                show_user_email_in_navbar();">
  {% include '_navbar.html' %}
  {% include '_wizard.html' %}
    <main>
        <section id="section" class="dashboard">
            <div class="row">
                <div class="chart" style="height: auto">
                    <div class="accordion" id="accordionExample" style="margin-top: 12px">
                      <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Select Geolocation of Consumers
                          </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                          <div class="accordion-body">
                              <p></p>
                            <strong>Draw a boundary around an area in which buildings should be automatically identified as consumers</strong>
                              <p></p>
                              <p>
                              <span>
                              <a>Remove Markers inside Boundary</a>
                              <label class="switch">
                              <input type="checkbox" id="toggleswitch">
                              <span class="slider round"></span>
                              </label>
                              </span>
                              </p>
                              <a id="drawPolygon" class="btn btn--medium"  href="javascript:void(0);" style="height: 32px; display: flex; justify-content: center; align-items: center; max-width: 180px; margin-bottom: 10px;">Draw Polygon</a>
                            <a id="drawRectangle" class="btn btn--medium"  href="javascript:void(0);" style="height: 32px; display: flex; justify-content: center; align-items: center; max-width: 180px">Draw Rectangle</a>
                              <p></p>
                            <p><strong>Define individual consumer manually on the map by mouse click</strong></p>
                              <p></p>
                            <a id="drawMarker" class="btn btn--medium" href="javascript:void(0);" style="height: 32px; display: flex; justify-content: center; align-items: center; max-width: 180px">Mark Consumers</a>
                              <p></p>
                            <p><strong>Define individual consumer manually by specifying the geocoordinates</strong></p>
                              <p></p>
                              <div style="display: flex">
                                <div class="input-group" style="max-width: 200px">
                                  <input
                                    type="number"
                                    class="form-control"
                                    id="latitude2"
                                    placeholder="Latitude"
                                    value=""
                                    min="2"
                                    max="16"
                                    step="0.00001"
                                    required
                                  />
                                  <span class="input-group-text" style="margin-right: 8px;">Degree</span>
                                </div>
                                  <div class="input-group" style="max-width: 200px">
                                  <input
                                    type="number"
                                    class="form-control"
                                    id="longitude2"
                                    placeholder="Longitude"
                                    value=""
                                    min="2"
                                    max="16"
                                    step="0.00001"
                                    required
                                  />
                                  <span class="input-group-text" style="margin-right: 8px;">Degree</span>
                                </div>
                                <a id="submit" class="btn btn--medium"  href="javascript:void(0);" onclick="add_consumer();" style="height: 32px; display: flex; align-items: center; justify-content: center;">Submit</a>
                              </div>
                          </div>
                            </div>
                        </div>
                      </div>
                      <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            Set Consumer Properties
                          </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                          <div class="accordion-body" style="border-bottom: none;">
                             <p>
                              <span>
                              <a>Show advanced Options</a>
                              <label class="switch">
                              <input type="checkbox" id="toggleswitch2">
                              <span class="slider round"></span>
                              </label>
                              </span>
                              </p>
                               <p><strong>To set consumer properties, first select the consumers by clicking on the markers on the map</strong></p>
                            <table style="border-top: none;">
                              <tr >
                                <th>Consumer Type</th>
                                <th>Consumer Category</th>
                                <th>Latitude</th>
                                <th>Longitude</th>
                                <th>Grid-/SHS-Options</th>
                                <th>Delete Consumer</th>
                                <th></th>
                                <th></th>
                              </tr>
                                <TR>
                                   <TD>
                                        <div class="input-item" style="margin-right: 30px;">
                                        <select id="consumer" class="form-select" style="max-width: 150px">
                                          <option>Household</option>
                                        </select>
                                        </div>
                                   </TD>
                                   <TD>
                                        <div class="input-item" style="display: flex; align-items: center;">
                                        <select id="enterprise" class="form-select" style="max-width: 150px;">
                                        <option>Enterprise</option>
                                        </select>
                                        </div>
                                   </TD>
                                   <TD>
                              <div class="input-group" style="max-width: 200px">
                              <input
                                type="number"
                                disabled="true"
                                class="form-control"
                                id="latitude"
                                placeholder=""
                                value=""
                                min="2"
                                max="16"
                                step="0.00001"
                                required
                              />
                              <span class="input-group-text">Degree</span>
                            </div></TD>
                                   <TD>
                              <div class="input-group" style="max-width: 200px">
                              <input
                                type="number"
                                disabled="true"
                                class="form-control"
                                id="longitude"
                                placeholder=""
                                value=""
                                min="2"
                                max="16"
                                step="0.00001"
                                required
                              />
                              <span class="input-group-text">Degree</span>
                            </div>
                                   </TD>
                                    <TD>
                                       <div class="input-item" style="margin-right: 30px;">
                                        <select id="shs_options" class="form-select" style="max-width: 150px">
                                                <option value="optimize">Optimize</option>
                                                <option value="grid">Grid</option>
                                                <option value="shs">SHS</option>
                                        </select>
                                        </div>
                                    </TD>
                                    <TD>
                                        <a id="submit"
                                           class="btn btn--medium"
                                           style="height: 32px; display: flex; align-items: center; justify-content: center;"
                                           onclick="delete_consumer();"
                                           href="javascript:void(0);">Delete</a>
                                    </TD>
                                   <TD><span style="float:right;"><a>&nbsp;
                                   </a></span></TD>
                                   <TD><span style="float:right;"><a>&nbsp;
                                   </a></span></TD>
                                </TR>
                            </table>
                          </div>
                        </div>
                      </div>

                    <div class="accordion-item" style="border-top: none">
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree">
                          <div class="accordion-body">

                              <div class="list_container"><div>
                              <p><b>Large loads to add</b></p>
                                        <div class="input-item" style="margin-right: 30px;  margin-bottom: 20px; width: 200px;">
                                        <select id="loads" class="form-select" style="max-width: 200px">
                                          <option>Motor</option>
                                        </select>
                                        </div>
                                  <div class="input-group" style="width: 200px;  margin-bottom: 20px;">
                                  <input
                                    type="number"
                                    class="form-control"
                                    id="number_loads"
                                    placeholder="Number"
                                    value="1"
                                    min="1"
                                    max="30"
                                    step="1"
                                    required/>
                                </div>
                                        <a id="add"
                                           class="btn btn--medium"
                                           style="height: 32px; display: flex; align-items: center; justify-content: center;  margin-bottom: 20px; width: 200px;"
                                           onclick="addElement();"
                                           href="javascript:void(0);">Add Load</a>
                                  </div>
                                  <div>

                                  <p><b>Selected Loads</b></p>
                                      <div class="list" id="load_list" style="width: 400px"></div></div>
                                  <div>
                                  </div>
                                  </div>
                          </div>
                        </div>
                      </div>

                <div id="search-container">
                        <input type="text" id="search-input" placeholder="Search location within Nigeria" class="input-group-text" style="text-align: left"/>
                </div>
                <p></p>
                <div id="map" style="min-height: 700px; min-width: 1000px; margin-bottom: 10px"></div>
                </div></div>
            </div>
        </section>
     {% include '_warningBox.html' %}
    </main>

  {% include '_footer.html' %}
  </body>
    {% include '_scripts.html' %}
<script src="{{ url_for('static', path='js/integrate_map.js') }}"></script>
<script src="{{ url_for('static', path='js/map_drawings.js') }}"></script>
<script src="{{ url_for('static', path='js/consumer_types.js') }}"></script>
<script>
function expandAccordionItem2() {
  const accordion = new bootstrap.Collapse(document.getElementById('collapseTwo'), {
    toggle: false
  });
  accordion.show();
}


document.getElementById('toggleswitch2').addEventListener('change', function (event) {
  const accordionItem3 = new bootstrap.Collapse(document.getElementById('collapseThree'), {
    toggle: false
  });

  if (event.target.checked) {
    accordionItem3.show();
  } else {
    accordionItem3.hide();
  }
});



  // Uncheck 'toggleswitch2' when 'collapseTwo' is hidden
  $('#collapseTwo').on('hidden.bs.collapse', function () {
    document.getElementById('toggleswitch2').checked = false;
  });

document.querySelector('#headingTwo .accordion-button').addEventListener('click', function () {
  const accordionItem2 = document.getElementById('collapseTwo');
  const accordionItem3 = new bootstrap.Collapse(document.getElementById('collapseThree'), {
    toggle: false
  });
  const toggleSwitch2 = document.getElementById('toggleswitch2');

  // Check if the accordion item 2 is currently collapsed
  if (!accordionItem2.classList.contains('show')) {
    accordionItem3.hide();
  } else if (toggleSwitch2.checked) {
    accordionItem3.show();
  }
});

function add_consumer() {
    update_map_elements();
    let lat = document.getElementById('latitude2').value;
    let lng = document.getElementById('longitude2').value;
    add_single_consumer_to_array(lat, lng, 'manual', 'consumer')
    drawMarker(lat, lng,'consumer');
}

function delete_consumer() {
    let lat = parseFloat(document.getElementById('latitude').value);
    let lng = parseFloat(document.getElementById('longitude').value);
    map_elements = map_elements.filter(function (obj) {
        return obj.latitude !== lat && obj.longitude !== lng;});
    map.eachLayer(function (layer) {
      if (layer instanceof L.Marker) {
        let markerLatLng = layer.getLatLng();
        if (markerLatLng.lat === lat && markerLatLng.lng === lng) {
          map.removeLayer(layer);
        }
      }
    });
}


function addElement() {
    // Get the dropdown selected value
    var dropdown = document.getElementById('loads');
    var selectedValue = dropdown.options[dropdown.selectedIndex].text;

    // Get the value from the input field
    var inputValue = document.getElementById('number_loads').value;

    // Get the list div
    var list = document.getElementById('load_list');

    // Create new list item and button
    var newItem = document.createElement('div');
    var newButton = document.createElement('button');

    // Add the class to the button
    newButton.classList.add('right-align');

    // Set button text and click event
    newButton.textContent = 'Delete';
    newButton.onclick = function() {
        list.removeChild(newItem);
    };

    // Add text and button to the new item
    newItem.textContent = inputValue + ' x ' + selectedValue + '    ';
    newItem.appendChild(newButton);

    // Add bottom margin to the new item
    newItem.style.marginBottom = '10px';

    // Append the new item to the list
    list.appendChild(newItem);
    document.getElementById('number_loads').value = '1';
}

var targetNode = document.getElementById('responseMsg');
var config = { childList: true, subtree: true, characterData: true };
var callback = function(mutationsList, observer) {
    for(let mutation of mutationsList) {
        if ((mutation.type === 'childList' || mutation.type === 'characterData') && targetNode.textContent.trim() !== '') {
            var modal = document.getElementById('msgBox');
            modal.style.display = "block";
        }
    }
};
var observer = new MutationObserver(callback);
observer.observe(targetNode, config);

</script>
</html>
